# 🚀 开始标定 - 从零到完成

## 现在就可以开始了！

---

## 📋 第一步：准备 AprilTag 标定板

### 选项 A：快速打印（推荐新手）

```bash
cd /home/psibot/Documents/psibot_control

# 下载标签图片
wget https://github.com/AprilRobotics/apriltag-imgs/raw/master/tag25h9/tag25_09_00000.png

# 打开图片看看
xdg-open tag25_09_00000.png
```

然后：
1. 用打印机打印这张图片
2. **重要**：调整打印尺寸，让黑色方块外边缘是 **75mm × 75mm**
3. 用尺子量一下，确认尺寸
4. 贴在硬纸板上，保持平整

**详细打印步骤** 👉 查看 `获取AprilTag指南.md`

### 选项 B：购买（如果不着急）

淘宝搜索："AprilTag 标定板 75mm tag25h9"

---

## 📋 第二步：准备硬件和环境

### 检查清单

- [ ] 相机已连接并通电
- [ ] 机器人已开机并连接网络
- [ ] AprilTag 固定在桌面上（在机器人工作空间内）
- [ ] 工作区域光照充足
- [ ] 桌面已清理干净

### 快速测试

```bash
# 测试相机
python list_cameras.py
# 应该能看到你的相机序列号

# 测试机器人网络 (左臂)
ping 192.168.100.100

# 测试机器人网络 (右臂)  
ping 192.168.100.101
```

---

## 📋 第三步：运行配置向导

这个脚本会自动检查硬件并配置标定程序：

```bash
cd /home/psibot/Documents/psibot_control
python setup_calibration.py
```

**向导会做什么**：
1. ✅ 检测你的相机
2. ✅ 检查机器人连接
3. ✅ 确认 AprilTag 准备情况
4. ✅ 自动更新标定程序配置

**按照屏幕提示操作即可！**

---

## 📋 第四步：运行标定程序

### 启动程序

```bash
python camera_calibreate.py
```

### 你会看到什么

一个窗口显示：
- 实时相机画面
- 机器人当前位置
- 采集进度 (0/20)
- 操作提示

### 开始采集数据

#### 核心操作（只需记住这个）：

```
1. 移动机器人 → 让 AprilTag 出现在画面中
2. 看到绿色框稳定地框住标签 → 按 'c' 保存
3. 重复 15-20 次，每次位置和角度要不同
```

#### 采样策略（按这个顺序）：

**第 1-5 次**：不同高度
- 近：距离标签 20-25cm
- 中：距离标签 30-35cm
- 远：距离标签 40-50cm

**第 6-10 次**：不同角度
- 垂直向下看（90°）
- 从左上方斜看（约 60°）
- 从右上方斜看（约 60°）
- 从正前方斜看（约 45°）
- 从正后方斜看（约 45°）

**第 11-15 次**：不同水平位置
- 移到标签左侧上方
- 移到标签右侧上方
- 移到标签前方上方
- 移到标签后方上方
- 移到标签中心上方

**第 16-20 次**：随机组合
- 混合前面的高度、角度、位置
- 尽量覆盖你实际会用到的机器人姿态

### 常见提示信息

✅ **"✓ 成功保存位姿 X/20"** → 很好！继续

⚠️ **"位姿与前一个过于相似"** → 移动幅度太小，换个差异大的位置

❌ **"未检测到有效的AprilTag"** → 标签不在视野内或识别不清

### 完成采集

采集到 20 个位姿后：
- 程序自动计算标定结果
- 显示变换矩阵
- 保存到 `calibration_results/` 文件夹

---

## 📋 第五步：验证标定结果

**必做！** 验证标定质量很重要！

```bash
python vis_cam_to_base.py
```

**期望看到**：
- 机器人末端位置上有红绿蓝三色坐标轴
- 移动机器人，坐标轴准确跟随

**判断标定质量**：
- ✅ 好：坐标轴准确在末端上，偏差 < 2cm
- ❌ 差：坐标轴位置明显偏离，偏差 > 5cm

**如果质量差 → 重新标定**

---

## 📋 完整流程时间估计

- 准备 AprilTag：30 分钟（打印）或 3 天（购买）
- 配置检查：5 分钟
- 标定采集：20-30 分钟
- 验证结果：5 分钟

**总计**：1-2 小时（假设已有 AprilTag）

---

## 🆘 遇到问题怎么办？

### 问题：相机检测不到

```bash
# 检查相机连接
lsusb | grep Intel
# 应该能看到 Intel RealSense

# 重新插拔 USB
# 或重启 udev
sudo systemctl restart udev
```

### 问题：机器人连接不上

```bash
# 检查网络
ping 192.168.100.100

# 检查 IP 配置
ip addr show

# 如果 IP 不对，可能需要配置静态 IP
# 你的电脑应该和机器人在同一网段 (192.168.100.x)
```

### 问题：AprilTag 检测不稳定

- ✅ 增加光照
- ✅ 确保标签平整
- ✅ 调整相机距离（20-40cm）
- ✅ 避免运动模糊（移动后等稳定再按 'c'）

### 问题：不知道怎么移动机器人

- 如果有示教器：用示教器手动移动
- 如果没有示教器：需要先学习如何控制机器人
  - 查看 `control.py` 了解控制接口
  - 或创建简单的测试脚本

---

## ✅ 完成后做什么？

标定完成并验证通过后：

1. **备份标定文件**（很重要！）
   ```bash
   cp -r calibration_results calibration_results_backup_$(date +%Y%m%d)
   ```

2. **进入下一步**
   - 阅读：`下一步行动清单.md`
   - 第2步：点云获取与分割

---

## 📚 参考文档

- **详细教程**：`手眼标定详细教程.md`（理论+详解）
- **AprilTag 获取**：`获取AprilTag指南.md`（打印/购买）
- **总体规划**：`下一步行动清单.md`（所有步骤）
- **完整指南**：`VLM_MOTION_PLANNING_GUIDE.md`（全流程）

---

## 🎯 现在开始！

**如果你已经有 AprilTag**：

```bash
# 直接运行配置向导
python setup_calibration.py

# 然后按提示操作即可！
```

**如果还没有 AprilTag**：

```bash
# 先下载图片
wget https://github.com/AprilRobotics/apriltag-imgs/raw/master/tag25h9/tag25_09_00000.png

# 然后打印，查看打印指南
cat 获取AprilTag指南.md
```

---

## 💡 小提示

- 第一次标定可能需要多试几次，这很正常
- 不要着急，慢慢来，质量比速度重要
- 采样位姿越多越好，20 个是最少的，可以采 25-30 个
- 标定质量直接影响后续所有功能，值得花时间做好

---

**准备好了吗？开始吧！🚀**

有任何问题随时问我！

